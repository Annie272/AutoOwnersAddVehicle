<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Auto Owners Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css" />
    <style>
      .star { color: #ef4444; margin-left: 2px; }
      .modal-bg { background: rgba(0,0,0,0.4);}
      .hidden { display: none; }
    </style>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">
    <form
      id="mainForm"
      action="https://test.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8&orgId=00DU7000006EuID"
      method="POST"
      class="bg-white p-8 rounded-2xl shadow-md w-full max-w-3xl space-y-8"
      autocomplete="off"
      novalidate
    >
      <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
        Add Vehicle Auto Owners Form
      </h2>

      <!-- Policy Changes Section -->
      <section class="bg-gray-50 border rounded-xl p-6 shadow-inner" aria-label="Policy Changes Section">
        <h3 class="text-xl font-semibold mb-4 text-gray-700">Policy Changes</h3>

        <div class="mb-4">
          <label for="email" class="block text-sm font-medium text-gray-700">
            Email<span class="star">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"
            autocomplete="off"
          />
        </div>

        <input
          type="hidden"
          id="00NU7000005zuNN"
          name="00NU7000005zuNN"
          value="Add Vehicle"
        />

        <fieldset class="mb-4">
          <legend class="block text-sm font-medium text-gray-700 mb-1">
            Select the Request Type:<span class="star">*</span>
          </legend>
          <div class="flex space-x-6">
            <label class="inline-flex items-center">
              <input type="radio" name="requestTypeRadios" value="Y" class="mr-2" />Quote
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="requestTypeRadios" value="N" class="mr-2" />Endorsement
            </label>
          </div>
          <select id="00NU7000006IOzh" name="00NU7000006IOzh" class="hidden">
            <option value=""></option>
            <option value="Y">Y</option>
            <option value="N">N</option>
          </select>
        </fieldset>

        <div class="mb-4">
          <label for="00NU7000005zuX3" class="block text-sm font-medium text-gray-700">
            Policy Number<span class="star">*</span>
          </label>
          <input
            type="text"
            id="00NU7000005zuX3"
            name="00NU7000005zuX3"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
            autocomplete="off"
          />
        </div>

        <div class="mb-4">
          <label for="00NU7000005zuLl" class="block text-sm font-medium text-gray-700">
            Effective Date (MM/DD/YYYY)<span class="star">*</span>
          </label>
          <input
            type="text"
            id="00NU7000005zuLl"
            name="00NU7000005zuLl"
            placeholder="MM/DD/YYYY"
            maxlength="10"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"
            autocomplete="off"
          />
        </div>
      </section>

      <!-- Vehicle Section -->
      <section class="bg-gray-50 border rounded-xl p-6 shadow-inner" aria-label="Vehicle Section">
        <h3 class="text-xl font-semibold mb-4 text-gray-700">Vehicle Section</h3>

        <div class="mb-4">
          <label for="00NU7000006Knh3" class="block text-sm font-medium text-gray-700">
            VIN Number of New Vehicle<span class="star">*</span>
          </label>
          <input
            id="00NU7000006Knh3"
            maxlength="255"
            name="00NU7000006Knh3"
            size="20"
            type="text"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          />
        </div>

        <div class="mb-4">
          <label for="00NU7000007qMA6" class="block text-sm font-medium text-gray-700">
            Anti-Theft<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qMA6"
            name="00NU7000007qMA6"
            title="Anti-Theft"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="Category 1">Category 1</option>
            <option value="Category 2">Category 2</option>
          </select>
        </div>
      </section>

      <!-- Coverage Section -->
      <section class="bg-gray-50 border rounded-xl p-6 shadow-inner" aria-label="Coverage Section">
        <h3 class="text-xl font-semibold mb-4 text-gray-700">Coverage's Section</h3>

        <div class="mb-4">
          <label for="00NU7000006NdwT" class="block text-sm font-medium text-gray-700">
            Comprehensive Deductible<span class="star">*</span>
          </label>
          <select
            id="00NU7000006NdwT"
            name="00NU7000006NdwT"
            title="Comprehensive Deductible"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
             <option value="No Coverage">No Coverage</option>
            <option value="0">0</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="200">200</option>
            <option value="250">250</option>
            <option value="500">500</option>
            <option value="750">750</option>
            <option value="1,000">1,000</option>
            <option value="2,000">2,000</option>
            <option value="3,000">3,000</option>
            <option value="5,000">5,000</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="00NU7000006Ne7l" class="block text-sm font-medium text-gray-700">
            Collision Deductible<span class="star">*</span>
          </label>
          <select
            id="00NU7000006Ne7l"
            name="00NU7000006Ne7l"
            title="Collision Deductible"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
             <option value="No Coverage">No Coverage</option>
            <option value="0">0</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="200">200</option>
            <option value="250">250</option>
            <option value="500">500</option>
            <option value="750">750</option>
            <option value="1,000">1,000</option>
            <option value="2,000">2,000</option>
            <option value="3,000">3,000</option>
            <option value="5,000">5,000</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="00NU7000007qN69" class="block text-sm font-medium text-gray-700">
            Full Glass<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qN69"
            name="00NU7000007qN69"
            title="Full Glass"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="00NU7000007qNFp" class="block text-sm font-medium text-gray-700">
            Customizations and Electronics<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qNFp"
            name="00NU7000007qNFp"
            title="Customizations and Electronics"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="Included Limit">Included Limit</option>
            <option value="Custom Limit">Custom Limit</option>
          </select>
        </div>

        <!-- Custom Limit Value: shown/required only when "Custom Limit" is selected -->
        <div class="mb-4 hidden" id="customLimitWrapper">
          <label for="00NU7000007qNKf" class="block text-sm font-medium text-gray-700">
            Custom Limit Value<span class="star">*</span>
          </label>
          <input
            id="00NU7000007qNKf"
            maxlength="50"
            name="00NU7000007qNKf"
            size="20"
            type="text"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          />
        </div>

        <div class="mb-4">
          <label for="00NU7000007qNSj" class="block text-sm font-medium text-gray-700">
            Road Trouble Service<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qNSj"
            name="00NU7000007qNSj"
            title="Road Trouble Service"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="No Coverage">No Coverage</option>
            <option value="All Reasonable Costs">All Reasonable Costs</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="00NU7000007qNcP" class="block text-sm font-medium text-gray-700">
            Additional Expense<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qNcP"
            name="00NU7000007qNcP"
            title="Additional Expense"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="No Coverage">No Coverage</option>
            <option value="30 / 900">30 / 900</option>
            <option value="40 / 1,200">40 / 1,200</option>
            <option value="50 / 1,500">50 / 1,500</option>
            <option value="75 / 2,250">75 / 2,250</option>
            <option value="100 / 3,000">100 / 3,000</option>
            <option value="150 / 4,500">150 / 4,500</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="00NU7000007qNkT" class="block text-sm font-medium text-gray-700">
            Loan / Lease Gap<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qNkT"
            name="00NU7000007qNkT"
            title="Loan / Lease Gap"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="No Coverage">No Coverage</option>
            <option value="Loan Gap">Loan Gap</option>
            <option value="Lease Gap">Lease Gap</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="00NU7000007qNu9" class="block text-sm font-medium text-gray-700">
            Original Titleholder of Vehicle<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qNu9"
            name="00NU7000007qNu9"
            title="Original Titleholder of Vehicle"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="00NU7000007qNyz" class="block text-sm font-medium text-gray-700">
            Limited Transportation Network Company Driver Coverage<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qNyz"
            name="00NU7000007qNyz"
            title="Limited Transportation Network Company Driver Coverage"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </div>

        <div class="mb-0">
          <label for="00NU7000007qO2D" class="block text-sm font-medium text-gray-700">
            Original Equipment Manufacturer Parts Plus<span class="star">*</span>
          </label>
          <select
            id="00NU7000007qO2D"
            name="00NU7000007qO2D"
            title="Original Equipment Manufacturer Parts Plus"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          >
            <option value="">--None--</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </div>
      </section>

      <!-- Hidden Salesforce fields -->
      <input type="hidden" name="oid" value="00DU7000006EuID" />
      <input type="hidden" name="recordType" id="recordType" value="012U7000003Hjv3IAC" />
      <input type="hidden" name="retURL" value="https://bennettandporter.com/" />
      <input type="hidden" name="first_name" value="Auto Owners Add Vehicle" />
      <input type="hidden" name="last_name" value="Test Demo" />
      <input type="hidden" name="status" value="New" />
      <input type="hidden" name="phone" value="28436836129" />
      <input type="hidden" name="lead_source" value="Web Form" />
      <input type="hidden" id="00NU7000007OdKL" name="00NU7000007OdKL" value="Auto Owners" />
      <input type="hidden" name="delete_Action_Form__c" value="1" />
      <input type="hidden" name="company" value="Caelius Test Auto Owners Add Vehicle" />
      <input type="hidden" name="Debug_Notes__c" value="Safeco Test: 2025-06-27 07:21AM" />

      <div class="flex justify-end mt-6">
        <button
          type="button"
          id="reviewBtn"
          class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-xl hover:bg-blue-700 transition"
        >
          Review and Submit
        </button>
      </div>
    </form>

    <!-- Confirmation Dialog -->
    <div
      id="dialog"
      class="hidden fixed inset-0 flex items-center justify-center modal-bg z-50"
      role="dialog"
      aria-modal="true"
      aria-labelledby="dialogTitle"
    >
      <div class="bg-white rounded-lg p-6 max-w-md w-full shadow-lg text-gray-800">
        <h3 id="dialogTitle" class="text-lg font-semibold mb-4"></h3>
        <ul id="missingFieldsList" class="mb-4 text-red-600 text-sm"></ul>
        <div class="flex justify-end space-x-3" id="dialogButtons">
          <button
            id="proceedBtn"
            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-medium"
          >
            Proceed to End Request
          </button>
          <button
            id="editBtn"
            class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 font-medium"
          >
            Edit
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Pikaday date picker
        if (window.Pikaday) {
          new Pikaday({
            field: document.getElementById("00NU7000005zuLl"),
            format: "MM/DD/YYYY",
            toString(date) {
              const d = String(date.getDate()).padStart(2, "0");
              const m = String(date.getMonth() + 1).padStart(2, "0");
              const y = date.getFullYear();
              return `${m}/${d}/${y}`;
            },
            parse(dateString) {
              const [m, d, y] = dateString.split("/");
              return new Date(y, m - 1, d);
            },
          });
        }

        // Map radio buttons to hidden select for requestType
        const radios = document.querySelectorAll('input[name="requestTypeRadios"]');
        const hiddenSelect = document.getElementById("00NU7000006IOzh");

        function syncRequestType() {
          const checkedRadio = document.querySelector('input[name="requestTypeRadios"]:checked');
          hiddenSelect.value = checkedRadio ? checkedRadio.value : "";
        }

        radios.forEach((radio) => {
          radio.addEventListener("change", syncRequestType);
        });

        if (hiddenSelect.value !== "") {
          const matchedRadio = document.querySelector(
            `input[name="requestTypeRadios"][value="${hiddenSelect.value}"]`
          );
          if (matchedRadio) matchedRadio.checked = true;
        } else {
          hiddenSelect.value = "";
        }

        syncRequestType();

        // Custom Limit dynamic show/hide
        const customizationsSelect = document.getElementById("00NU7000007qNFp");
        const customLimitWrapper = document.getElementById("customLimitWrapper");
        const customLimitInput = document.getElementById("00NU7000007qNKf");

        function updateCustomLimitVisibility() {
          if (customizationsSelect.value === "Custom Limit") {
            customLimitWrapper.classList.remove("hidden");
          } else {
            customLimitWrapper.classList.add("hidden");
            customLimitInput.value = "";
          }
        }

        customizationsSelect.addEventListener("change", updateCustomLimitVisibility);
        updateCustomLimitVisibility();

        // Validation and dialog logic
        const reviewBtn = document.getElementById("reviewBtn");
        const dialog = document.getElementById("dialog");
        const dialogTitle = document.getElementById("dialogTitle");
        const missingFieldsList = document.getElementById("missingFieldsList");
        const proceedBtn = document.getElementById("proceedBtn");
        const editBtn = document.getElementById("editBtn");
        const form = document.getElementById("mainForm");

        const requiredFields = [
          { id: "email", label: "Email", type: "email" },
          { radioGroupName: "requestTypeRadios", label: "Select the Request Type:" },
          { id: "00NU7000005zuX3", label: "Policy Number" },
          { id: "00NU7000005zuLl", label: "Effective Date (MM/DD/YYYY)", type: "date" },
          { id: "00NU7000006Knh3", label: "VIN Number of New Vehicle" },
          { id: "00NU7000007qMA6", label: "Anti-Theft" },
          { id: "00NU7000006NdwT", label: "Comprehensive Deductible" },
          { id: "00NU7000006Ne7l", label: "Collision Deductible" },
          { id: "00NU7000007qN69", label: "Full Glass" },
          { id: "00NU7000007qNFp", label: "Customizations and Electronics" },
          // Custom Limit Value is conditionally required (checked in validation)
          { id: "00NU7000007qNSj", label: "Road Trouble Service" },
          { id: "00NU7000007qNcP", label: "Additional Expense" },
          { id: "00NU7000007qNkT", label: "Loan / Lease Gap" },
          { id: "00NU7000007qNu9", label: "Original Titleholder of Vehicle" },
          { id: "00NU7000007qNyz", label: "Limited Transportation Network Company Driver Coverage" },
          { id: "00NU7000007qO2D", label: "Original Equipment Manufacturer Parts Plus" }
        ];

        function validateFields() {
          const missing = [];

          requiredFields.forEach((field) => {
            if (field.radioGroupName) {
              const radios = document.querySelectorAll(`input[name="${field.radioGroupName}"]`);
              if (!radios.length) return;
              const checked = [...radios].some((r) => r.checked);
              if (!checked) missing.push(field.label);
              return;
            }

            const el = document.getElementById(field.id);
            if (!el) return;

            if (field.id === "00NU7000007qNKf") {
              // handled separately as conditional
              return;
            }

            if (field.type === "email") {
              if (!el.value.trim() || !el.checkValidity()) missing.push(field.label);
            } else if (field.type === "date") {
              const val = el.value.trim();
              const dateRegex =
                /^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/(1[0-9]{3}|2[0-9]{3}|30[0-9]{2})$/;
              if (!val || !dateRegex.test(val)) missing.push(field.label);
            } else {
              if (!el.value.trim()) missing.push(field.label);
            }
          });

          // Conditional requirement: Custom Limit Value
          if (customizationsSelect.value === "Custom Limit") {
            if (!customLimitInput.value.trim()) {
              missing.push("Custom Limit Value");
            }
          }

          return missing;
        }

        reviewBtn.addEventListener("click", () => {
          const missing = validateFields();
          if (missing.length) {
            dialogTitle.textContent =
              "Below Mandatory Fields are missing and the Team will contact you shortly.";
            missingFieldsList.innerHTML = missing.map((f) => `<li>${f}</li>`).join("");
          } else {
            dialogTitle.textContent =
              "All mandatory fields are completed. Ready to submit your request?";
            missingFieldsList.innerHTML = "";
          }
          dialog.classList.remove("hidden");
        });

        editBtn.addEventListener("click", () => {
          dialog.classList.add("hidden");
        });

        proceedBtn.addEventListener("click", () => {
          dialog.classList.add("hidden");
          form.submit();
        });

        window.addEventListener("click", (e) => {
          if (e.target === dialog) {
            dialog.classList.add("hidden");
          }
        });

        window.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !dialog.classList.contains("hidden")) {
            dialog.classList.add("hidden");
          }
        });
      });
    </script>
  </body>
</html>
